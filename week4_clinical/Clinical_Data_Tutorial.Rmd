---
title: "Clinical Data Tutorial"
author: Nicole Black
date: 07/17/22
---

###### Set Up

Set your working environment to analysis_data:

```{r setup}
    knitr::opts_knit$set(root.dir = normalizePath("/PATH/TO/analysis_data")) 
```

Load in any the BiocManager and TCGAbiolinks packages:

```{r}
# load in packages
```

Re-query and prepare your data. NOTE: You don't have to download it again!!

```{r}
clinical_query <- GDCquery(FILL IN HERE)

clinical <- GDCprepare_clinic(FILL IN HERE)
```

###### Exploring Age (Boolean Indexing!)

There are many factors to explore in the clinical data, but for now, we will be focusing on age. Early onset breast cancer (typically defined as < 45 years old) is often associated with a more aggressive tumor type as well as a poorer prognosis.

Look up "early onset breast cancer" in Google Scholar and pick a paper to skim.
    1. Link to paper:
    2. What is one thing you learned from this paper: 
    
Let's start with an overview of the age data. Run the following functions on the age_at_initial_pathologic_diagnosis column. Record the output below.
    1. min() = 
    2. max() = 
    3. mean() = 
    4. median() = 
    5. summary() = 

```{r}
# write code here
```

For the purposes of our analysis, we will define "young" as < 50 y/o, and "old" as >= 50 y/o.

Create a column in "clinical" called "age_category" with the values "young" and "old". HINT: Use an ifelse statement to do this. If you need help recalling how to create a new column, see the "Editing data frames" section of Intro_to_R.Rmd

```{r}
# write code here
```

How many patients are young vs old? Use the sum() function to find out.
    1. Young = 
    2. Old = 
    
```{r}
# write code here
```

Now, let's say we want to create a new clinical data frame with only young patients. How can we do that?

Remember Boolean masking from R_Practice.Rmd? In that notebook, we created a boolean mask, or a vector of boolean values (TRUE/FALSE) than could be applied to the df[rows, columns] syntax to select for only TRUE rows/columns. In that case, we created our mask using is.na(), a function that automatically returns a boolean vector. But we can also create the boolean vector ourselves!

Create a boolean vector using an ifelse() statement where young patients (< 50) are TRUE, and old patients (>= 50) are FALSE.

```{r}
age_mask <- # write code here
```

Call the sum function on age_mask. Remember that TRUEs are treated as 1, and FALSEs are treated as 0. Knowing this, can you predict what sum we will get based?
    1. Sum = 

```{r}
# write code here
```

Now let's take the age_mask and apply it to create a new subsetted data frame. You can do this by placing the mask on either the rows or columns side of the df[rows, columns] format.
    ie: clinical[age_mask , ] OR clinical[ , age_mask]
    
Which side do we place it on? Let's think. If we place the mask in the rows side, R will travel down the rows of the clinical data frame and check the corresponding TRUE/FALSE value, keeping or ignoring rows accordingly. If we place the mask in the columns side, R will keep or ignore columns accordingly.

We want to select for patients who are young. Will keeping/ignoring rows or columns allow us to create our young_clinical df? HINT: what data is stored in rows and what data is stored in columns?

```{r}
young_clinical <- clinical[ADD MASK HERE]
```

View the young_clinical data frame to ensure that you created it as intended.

Now, create an old_clinical data frame using the SAME mask as before. What do you have to change? Remember that TRUE rows/columns are kept, and FALSE rows/columns are ignored.

```{r}
old_clinical <- 
```

The number of rows in the young_clinical data frame added to the number of rows in the old_clinical data frame should sum up to the number of rows in the clinical data frame.

Let's check to make sure that nothing went wrong in our process:

```{r}
nrows(clinical) == # write code here
```

The statement you just wrote (x == y) is called an assert statement, and it can be used as a sanity check to make sure that everything is working as it should.

###### Kaplan-Meier Plots

Now, we're going to look at Kaplan-Meier plots separated by age category. A Kaplan-Meier plot (KM plot) is a survival curve that shows the probability of survival based on a certain factor (ex: age, treatment, sex, etc.) at a certain point in time. This plot allows us to determine whether a given factor affects survival probabilities, and if so, how. For more info on KM plots, read the following two articles:
    1. 
    2.
    
Before we get started, install and load the "survival" and "survminer" packages.

```{r}
# install and load packages 
```

To create a KM plot, we need three sets of data: survival_time, death_event, and a grouping variable (in this case, age_category).

Let's create a column in clinical called survival_time.

###### Saving files

